# Tennessee Eastman (TE) 工艺故障检测 — 实验报告（PCA baseline）

版本与摘要
---------
- 报告说明：基于仓库中 `output/` 的检测结果（PCA 重构误差基线），对实验方法、实现细节与结果进行说明与分析。
- 主要结论：
  - 在 21 类故障上的平均检测率 ≈ 0.6384（63.84%）。
  - 多数故障能被有效检测（若干接近 100%），但存在数个难以检测或检测延迟大的故障（d03、d09、d15 等）。

一、数据概述
-----------
- 数据集：22 组文件，d00 为正常数据，d01..d21 为 21 种故障。
- 每文件维度：961 × 52（52 个测量变量，文件无表头，空格分隔）。
- 故障区间：对于故障文件（d01..d21），样本索引 161 开始出现故障，评估时只关注区间 161..960（共 800 个样本）。
- 采样间隔：3 分钟（若需将样本延迟换算为时间，delay_minutes = delay_samples * 3）。

二、方法概述（使用的算法与原理）
----------------------------
本次基线选用 PCA（主成分分析）重构误差作为异常分数，步骤如下：

1. 标准化（StandardScaler）
   - 对训练（正常）数据每个特征做零均值单位方差归一化，保证各特征尺度一致。
2. PCA 建模
   - 在标准化后的正常数据上拟合 PCA，保留若干主成分（实验中默认 n_components=10，可配置）。
   - PCA 将数据投影到低维主成分空间，再逆投影得到重构值。
3. 重构误差（reconstruction error）
   - 每个样本的重构误差定义为所有特征均方误差（MSE）：mean((x - x_rec)^2)。
   - 直觉：正常数据在主成分空间能被较好重构；异常样本（含故障）重构误差显著增大。
4. 阈值确定
   - 在训练（正常）数据的重构误差上使用百分位法设阈（默认 99%）。若误差 > 阈值则判定为“告警”（异常）。
   - 也支持 mean + k * std 方式作为可选阈值策略。

方法优点与局限性（简述）
- 优点：
  - 实现简洁、计算效率高、对高维数据常能提取主要变化模式。
  - 对某些突变或明显偏离的故障效果很好。
- 局限：
  - PCA 假设主要变化方向能代表“正常”，但某些故障可能仅影响少数变量或以小幅逐步漂移表现，导致重构误差不显著。
  - 阈值选择对检测率与误报率敏感，需要根据应用场景调整。
  - 不建模时间依赖关系（逐样本独立处理），对逐步累积或慢漂故障不敏感。

三、实现细节
-----------
- 训练集：使用 `d00_te.dat` 的全部样本（0..960）来训练标准化器与 PCA。
- 测试集：对每一个故障文件（d01..d21），将所有样本标准化后计算重构误差并与阈值比较，统计评估区间 161..960 的检测情况。
- 阈值：默认采用训练重构误差的第 99 百分位数作为阈值（可配置）。
- 输出：
  - 对每个故障计算 detection_rate = (# 告警样本在 161..960) / 800（或实际样本数）。
  - 记录首次检测索引（若在评估区间内没有告警则记为 None）与延迟（样本数）。

四、实验结果（检测率表）
-----------------------
下表为 `output/detection_results_pca.csv` 中记录的结果（针对样本 161..960）：

| fault_file | fault_id | detection_rate | detected_count | num_fault_samples | first_detect_idx | delay_samples |
|---:|---|---:|---:|---:|---:|---:|
| d01_te.dat | d01 | 0.9974968710888611 | 797 | 799 | 163 | 3 |
| d02_te.dat | d02 | 0.986232790988736  | 788 | 799 | 172 | 12 |
| d03_te.dat | d03 | 0.03254067584480601| 26  | 799 | 180 | 20 |
| d04_te.dat | d04 | 0.9887359198998749 | 790 | 799 | 162 | 2 |
| d05_te.dat | d05 | 0.27033792240300375| 216 | 799 | 161 | 1 |
| d06_te.dat | d06 | 1.0                | 799 | 799 | 161 | 1 |
| d07_te.dat | d07 | 1.0                | 799 | 799 | 161 | 1 |
| d08_te.dat | d08 | 0.9737171464330413 | 778 | 799 | 179 | 19 |
| d09_te.dat | d09 | 0.02252816020025031| 18  | 799 | 224 | 64 |
| d10_te.dat | d10 | 0.2453066332916145 | 196 | 799 | 186 | 26 |
| d11_te.dat | d11 | 0.7171464330413017 | 573 | 799 | 165 | 5 |
| d12_te.dat | d12 | 0.9624530663329162 | 769 | 799 | 162 | 2 |
| d13_te.dat | d13 | 0.9549436795994993 | 763 | 799 | 196 | 36 |
| d14_te.dat | d14 | 1.0                | 799 | 799 | 161 | 1 |
| d15_te.dat | d15 | 0.026282853566958697| 21  | 799 | 237 | 77 |
| d16_te.dat | d16 | 0.2127659574468085 | 170 | 799 | 171 | 11 |
| d17_te.dat | d17 | 0.9249061326658323 | 739 | 799 | 184 | 24 |
| d18_te.dat | d18 | 0.9036295369211514 | 722 | 799 | 220 | 60 |
| d19_te.dat | d19 | 0.25406758448060074| 203 | 799 | 170 | 10 |
| d20_te.dat | d20 | 0.4793491864831039 | 383 | 799 | 242 | 82 |
| d21_te.dat | d21 | 0.45431789737171463| 363 | 799 | 173 | 13 |

- 平均检测率（21 faults）≈ 0.6384（63.84%）

五、可视化（说明）
----------------
- `detection_rates_pca.png`: 各故障检测率条形图，可直观比较哪些故障易/难检测。
- `timeline_d06_te.dat_pca.png`, `timeline_d09_te.dat_pca.png`, `timeline_d18_te.dat_pca.png`：示例时间线，展示重构误差随时间变化与报警标记、故障起始位置（sample 161）。其中：
  - d06 的时间线显示故障后重构误差立即升高并持续，故检测率 1.0；
  - d09 的时间线（以及检测率 0.0225）显示该故障在主成分重构误差上几乎无显著反应，或响应非常迟缓；
  - d18 检测率较高但首次检测位置较晚（延迟较大），见 timeline 可观察到误差逐步上升的趋势。

六、结果分析与讨论
-----------------
1. 检测成功的故障（高检测率）
   - d01, d02, d04, d06, d07, d12, d13, d14 等在 PCA 重构误差上表现明显，说明这些故障导致系统变量发生显著偏离正常子空间，PCA 能有效捕获。
   - 这些故障中多数首次检测索引靠近故障起点（delay_samples 小），说明突变式故障容易被重构误差捕获。

2. 检测效果差的故障（低检测率或极低）
   - d03 (≈3.25%)、d09 (≈2.25%)、d15 (≈2.63%)：检测率极低，说明这些故障在被训练的 PCA 模型所捕获的主成分空间中并不突出；可能为：
     - 故障影响的量测变量较少且振幅小；
     - 故障表现为缓慢漂移或与正常变化方向相似；
     - 或者这些故障更体现为过程动力学（时间序列相关）变化，而非瞬时观测值的异常。
   - 对此类故障，单样本的重构误差不足以判断故障，需要考虑时间窗口/序列建模（如 LSTM-AE、1D-CNN、或滑动窗口统计特征）、或基于统计累积量（CUSUM、EWMA）的方法。

3. 延迟较大的情况
   - 某些故障（例如 d20 延迟 82 样本，即 246 分钟）即使最终被检测到也存在明显延迟，可能为逐步累积型故障。延迟对工业在线检测影响较大，应根据场景考量能否接受。

4. 误报/阈值敏感性
   - 阈值采用训练集 99 百分位会控制误报，但也影响召回（检测率）。不同阈值策略需在误报率/召回率之间权衡。可通过 ROC 类曲线分析不同阈值的 trade-off。

七、局限与建议（用于理解实验结果）
---------------------------------
- PCA 为线性无监督方法，适于捕捉主要线性变异方向，若故障表现在次要或非线性子空间则检测难度增加。
- 建议进一步尝试/比较以下方法以提升对难检故障的敏感性：
  - 序列建模 Autoencoder（LSTM-AE / 1D-CNN AE）以利用时间依赖信息；
  - 基于密度/分离的检测器（IsolationForest、OneClassSVM）或基于概率模型（GMM）；
  - 特征工程：构造滑动窗口统计特征（均值、方差、斜率等）或主变量组合；
  - 集成检测：融合多模型（PCA + AE + IsolationForest）并采用投票/置信度融合；
  - 调整阈值策略（按故障类别/按业务可接受误报率调优），或采用动态阈值；
  - 进一步分析单个变量的贡献（哪几个变量对重构误差贡献最大），有助于定位故障并改进特征选择。

附：重要数值说明（延迟换算）
- delay_samples → delay_minutes = delay_samples × 3
  - 例如 d20 delay_samples = 82 → delay_minutes = 246 分钟（约 4.1 小时）。

结论
----
PCA 重构误差作为 baseline 对许多 TE 故障（尤其突变型）表现良好，但对若干故障（d03、d09、d15 等）效果差且/或延迟较大，说明需要补充时序模型、非线性模型或更丰富的特征来提升召回与降低延迟。完整的检测结果与时序图已存放于 `output/` 目录下，供进一步诊断与模型改进参考。

（完）